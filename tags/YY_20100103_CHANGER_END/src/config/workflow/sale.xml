<?xml version="1.0" encoding="GBK"?>

<process-definition xmlns="urn:jbpm.org:jpdl-3.1" name="sale">
	<start-state name="开始">
		<transition name="填写销售单" to="保存提交">
			<action name="保存申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>saveOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>
	</start-state>
	<end-state name="销售单正常关闭"></end-state>
	<decision name="保存提交">
		<handler config-type="bean"
			class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
			<targetBean>saveDecision</targetBean>
			<factoryKey>jbpmConfiguration</factoryKey>
		</handler>
		<transition name="保存" to="保存销售单"></transition>
		<transition name="提交" to="总经理审核">
			<action name="提交申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>submitOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>
	</decision>
	<task-node name="保存销售单">
		<task name="Task">
			<assignment config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>saveOutHandler</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</assignment>
		</task>

		<transition name="提交" to="总经理审核">
			<action name="提交申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>submitOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>

		<transition name="删除" to="销售单结束">
			<action name="删除申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>delOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>

		<transition name="修改" to="保存提交">
			<action name="修改申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>saveOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>
	</task-node>

	<task-node name="总经理审核">
		<task name="Task" />
		<transition name="驳回" to="驳回">
			<action name="驳回申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>rejectOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>
      <transition name="通过" to="是否总部物流审核"></transition>
	</task-node>

	<task-node name="驳回">
		<task name="Task" />
		<transition name="删除" to="销售单结束">
			<action name="删除申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>delOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>
		<transition name="修改" to="保存提交">
			<action name="修改申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>saveOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>
		<transition name="提交" to="总经理审核">
			<action name="提交申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>submitOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>
	</task-node>

	<end-state name="销售单结束"></end-state>

	<task-node name="物流管理员审核">
		<task name="Task" />
		<transition name="驳回" to="驳回">
			<action name="驳回申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>rejectOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>
		<transition name="通过" to="库管审核">
			<action name="通过申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>passOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>
	</task-node>
	<task-node name="库管审核">
		<task name="Task" />
		<transition name="通过" to="会计核对">
			<action name="通过申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>passOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>
		<transition name="驳回" to="驳回">
			<action name="驳回申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>rejectOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>
	</task-node>
	<task-node name="会计核对">
		<task name="Task" />
		<transition name="核对" to="销售单正常关闭">
			<action name="核对" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>checkOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
		</transition>
	</task-node>
   <decision name="是否总部物流审核">
   	  <handler config-type="bean"
			class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
			<targetBean>flowDecision</targetBean>
			<factoryKey>jbpmConfiguration</factoryKey>
		</handler>	
      <transition name="否" to="库管审核">
      	<action name="通过申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>passOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
      </transition>
      <transition name="是" to="物流管理员审核">
      	<action name="通过申请单" config-type="bean"
				class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
				<targetBean>passOutAction</targetBean>
				<factoryKey>jbpmConfiguration</factoryKey>
			</action>
      </transition>
   </decision>
</process-definition>