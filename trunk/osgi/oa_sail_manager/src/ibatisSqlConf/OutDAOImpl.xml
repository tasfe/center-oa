<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="OutDAO">

    <!-- 在途的产品 -->
	<select id="sumPreassignAmount" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		<![CDATA[
            select sum(t2.amount) from t_center_out t1, t_center_base t2 
            where t1.fullid = t2.outid 
            and t1.type = #type# 
            and t1.location = #location# 
            and t2.productId = #productId# 
            and t1.outtime >= #beginDate# 
            AND t1.outtime <= #endDate# 
            AND t1.status in (1, 6, 7, 8, 9)
        ]]>
	</select>
	
	<!-- 客户信用预占金额 -->
	<select id="sumNoPayBusiness" parameterClass="java.util.Map" resultClass="java.lang.Double">
        <![CDATA[
            select sum(t1.curcredit) from t_center_out t1
            where t1.customerId = #customerId# 
            AND t1.type = 0 
            AND t1.pay = 0
            AND t1.outTime >= #beginDate#
            AND t1.outTime <= #endDate#
            AND t1.status in (1, 3, 4, 6, 7, 8)
        ]]>
    </select>
    
    <!-- 职员信用预占金额 -->
    <select id="sumNoPayAndAvouchBusinessByStafferId" parameterClass="java.util.Map" resultClass="java.lang.Double">
        <![CDATA[
            select sum(t1.staffcredit) from t_center_out t1
            where t1.stafferId = #stafferId# 
            AND t1.type = 0 
            AND t1.pay = 0
            AND t1.outTime >= #beginDate#
            AND t1.outTime <= #endDate#
            AND t1.status in (1, 3, 4, 6, 7, 8)
        ]]>
    </select>
    
    <!-- 分公司经理信用预占金额 -->
    <select id="sumNoPayAndAvouchBusinessByManagerId" parameterClass="java.util.Map" resultClass="java.lang.Double">
        <![CDATA[
            select sum(t1.managercredit) from t_center_out t1
            where t1.managerId = #stafferId# 
            AND t1.type = 0 
            AND t1.pay = 0
            AND t1.outTime >= #beginDate#
            AND t1.outTime <= #endDate#
            AND t1.status in (1, 3, 4, 6, 7, 8)
        ]]>
    </select>
    
    <!-- 销售产品在途的,主要是调价需要剔除 -->
    <select id="countNotEndProductInOut" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		<![CDATA[
            select count(t2.productId) from t_center_out t1, t_center_base t2 
            where t1.fullid = t2.outid 
            and t1.type = 0 
            and t2.productId = #productId# 
            and t1.outtime >= #beginDate# 
            AND t1.outtime <= #endDate# 
            AND t1.status in (1, 6, 7, 8, 9)
        ]]>
	</select>
	
	<!-- 入库产品在途的,主要是调价需要剔除 -->
	<select id="countNotEndProductInIn" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		<![CDATA[
            select count(t2.productId) from t_center_out t1, t_center_base t2 
            where t1.fullid = t2.outid 
            and t1.type = 1 
            and t1.inway = 1 
            and t2.productId = #productId# 
            and t1.outtime >= #beginDate# 
            AND t1.outtime <= #endDate# 
            AND t1.status = 1
        ]]>
	</select>
	
	<!-- 销售产品在途的,主要是显示库存页面需要 -->
	<select id="sumNotEndProductInOutByStorageRelation" parameterClass="java.util.Map" resultClass="java.lang.Integer">
        <![CDATA[
            select sum(t2.amount) from t_center_out t1, t_center_base t2 
            where t1.fullid = t2.outid 
            and t1.type = 0 
            and t2.productId = #productId# 
            and t2.depotpartId = #depotpartId# 
            and t2.depotpartId = #depotpartId# 
            and t2.costPriceKey = #costPriceKey# 
            and t2.owner = #owner# 
            and t1.outtime >= #beginDate# 
            AND t1.outtime <= #endDate# 
            AND t1.status in (1, 6, 7, 8, 9)
        ]]>
    </select>
    
    <!-- 入库产品在途的,主要是显示库存页面需要 -->
    <select id="sumNotEndProductInInByStorageRelation" parameterClass="java.util.Map" resultClass="java.lang.Integer">
        <![CDATA[
            select sum(t2.amount) from t_center_out t1, t_center_base t2 
            where t1.fullid = t2.outid 
            and t1.type = 1 
            and t2.productId = #productId# 
            and t2.depotpartId = #depotpartId# 
            and t2.depotpartId = #depotpartId# 
            and t2.costPriceKey = #costPriceKey# 
            and t2.owner = #owner# 
            and t1.outtime >= #beginDate# 
            AND t1.outtime <= #endDate# 
            AND t1.status = 1
        ]]>
    </select>

</sqlMap>
