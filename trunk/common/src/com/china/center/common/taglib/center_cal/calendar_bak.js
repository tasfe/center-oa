/*
 * modify by zhuzhu
 * base function is showCalendar(id, format, showsTime, showsOtherMonths)
 * used function is: calDate(id)
 * used function is: calDateTime(id)
 * 2007-10-28
 */
var _=1,E=9999,K=60*1000,L=60*K,J=24*L,A=7*J;function calDate($){showCalendar($,"%Y-%m-%d")}function calDateTime($){showCalendar($,"%Y-%m-%d %H:%M:%S","24",true)}function showCalendar(B,H,A,F){var C=document.getElementById(B);if(_dynarch_popupCalendar!=null)_dynarch_popupCalendar.hide();else{var G=new Calendar(1,null,I,D);if(typeof A=="string"){G.showsTime=true;G.time24=(A=="24")}if(F)G.showsOtherMonths=true;_dynarch_popupCalendar=G;G.setRange(_,E);G.create()}_dynarch_popupCalendar.setDateFormat(H);_dynarch_popupCalendar.parseDate(C.value);_dynarch_popupCalendar.sel=C;_dynarch_popupCalendar.showAtElement($(C.nextSibling),"Br");return false}function $(_){if(_.tagName&&_.tagName.toLowerCase()=="input")return _;else return $(_.nextSibling)}function I($,_){$.sel.value=_;if($.dateClicked&&($.sel.id=="sel1"||$.sel.id=="sel3"))$.callCloseHandler()}function D($){$.hide();_dynarch_popupCalendar=null}function H(_){var $=new Date();return(Math.abs(_.getTime()-$.getTime())/J)>10}function M(_,A){var $=document.getElementById("preview");$.innerHTML=A}function C(){var $=document.getElementById("display"),_=new Calendar(0,null,M);_.weekNumbers=false;_.setDisabledHandler(H);_.setDateFormat("%A, %B %e");_.create($);_.show()}Calendar=function(D,B,C,A){this.activeDiv=null;this.currentDateEl=null;this.getDateStatus=null;this.getDateToolTip=null;this.getDateText=null;this.timeout=null;this.onSelected=C||null;this.onClose=A||null;this.dragging=false;this.hidden=false;this.minYear=_;this.maxYear=E;this.dateFormat=Calendar._TT["DEF_DATE_FORMAT"];this.ttDateFormat=Calendar._TT["TT_DATE_FORMAT"];this.isPopup=true;this.weekNumbers=true;this.firstDayOfWeek=typeof D=="number"?D:Calendar._FD;this.showsOtherMonths=false;this.dateStr=B;this.ar_days=null;this.showsTime=false;this.time24=true;this.yearStep=2;this.hiliteToday=true;this.multiple=null;this.table=null;this.element=null;this.tbody=null;this.firstdayname=null;this.monthsCombo=null;this.yearsCombo=null;this.hilitedMonth=null;this.activeMonth=null;this.hilitedYear=null;this.activeYear=null;this.dateClicked=false;if(typeof Calendar._SDN=="undefined"){if(typeof Calendar._SDN_len=="undefined")Calendar._SDN_len=3;var $=new Array();for(var F=8;F>0;)$[--F]=Calendar._DN[F].substr(0,Calendar._SDN_len);Calendar._SDN=$;if(typeof Calendar._SMN_len=="undefined")Calendar._SMN_len=3;$=new Array();for(F=12;F>0;)$[--F]=Calendar._MN[F].substr(0,Calendar._SMN_len);Calendar._SMN=$}};Calendar._C=null;Calendar.is_ie=(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent));Calendar.is_ie5=(Calendar.is_ie&&/msie 5\.0/i.test(navigator.userAgent));Calendar.is_opera=/opera/i.test(navigator.userAgent);Calendar.is_khtml=/Konqueror|Safari|KHTML/i.test(navigator.userAgent);Calendar.getAbsolutePos=function(_){var B=0,$=0,D=/^div$/i.test(_.tagName);if(D&&_.scrollLeft)B=_.scrollLeft;if(D&&_.scrollTop)$=_.scrollTop;var A={x:_.offsetLeft-B,y:_.offsetTop-$};if(_.offsetParent){var C=this.getAbsolutePos(_.offsetParent);A.x+=C.x;A.y+=C.y}return A};Calendar.isRelated=function($,_){var B=_.relatedTarget;if(!B){var A=_.type;if(A=="mouseover")B=_.fromElement;else if(A=="mouseout")B=_.toElement}while(B){if(B==$)return true;B=B.parentNode}return false};Calendar.removeClass=function(_,B){if(!(_&&_.className))return;var $=_.className.split(" "),A=new Array();for(var C=$.length;C>0;)if($[--C]!=B)A[A.length]=$[C];_.className=A.join(" ")};Calendar.addClass=function($,_){Calendar.removeClass($,_);$.className+=" "+_};Calendar.getElement=function(_){var $=Calendar.is_ie?window.event.srcElement:_.currentTarget;while($.nodeType!=1||/^div$/i.test($.tagName))$=$.parentNode;return $};Calendar.getTargetElement=function(_){var $=Calendar.is_ie?window.event.srcElement:_.target;while($.nodeType!=1)$=$.parentNode;return $};Calendar.stopEvent=function($){$||($=window.event);if(Calendar.is_ie){$.cancelBubble=true;$.returnValue=false}else{$.preventDefault();$.stopPropagation()}return false};Calendar.addEvent=function($,_,A){if($.attachEvent)$.attachEvent("on"+_,A);else if($.addEventListener)$.addEventListener(_,A,true);else $["on"+_]=A};Calendar.removeEvent=function($,_,A){if($.detachEvent)$.detachEvent("on"+_,A);else if($.removeEventListener)$.removeEventListener(_,A,true);else $["on"+_]=null};Calendar.createElement=function(A,_){var $=null;if(document.createElementNS)$=document.createElementNS("http://www.w3.org/1999/xhtml",A);else $=document.createElement(A);if(typeof _!="undefined")_.appendChild($);return $};Calendar._add_evs=function(el){with(Calendar){addEvent(el,"mouseover",dayMouseOver);addEvent(el,"mousedown",dayMouseDown);addEvent(el,"mouseout",dayMouseOut);if(is_ie){addEvent(el,"dblclick",dayMouseDblClick);el.setAttribute("unselectable",true)}}};Calendar.findMonth=function($){if(typeof $.month!="undefined")return $;else if(typeof $.parentNode.month!="undefined")return $.parentNode;return null};Calendar.findYear=function($){if(typeof $.year!="undefined")return $;else if(typeof $.parentNode.year!="undefined")return $.parentNode;return null};Calendar.showMonthsCombo=function(){var C=Calendar._C;if(!C)return false;var C=C,D=C.activeDiv,_=C.monthsCombo;if(C.hilitedMonth)Calendar.removeClass(C.hilitedMonth,"hilite");if(C.activeMonth)Calendar.removeClass(C.activeMonth,"active");var A=C.monthsCombo.getElementsByTagName("div")[C.date.getMonth()];Calendar.addClass(A,"active");C.activeMonth=A;var $=_.style;$.display="block";if(D.navtype<0)$.left=D.offsetLeft+"px";else{var B=_.offsetWidth;if(typeof B=="undefined")B=50;$.left=(D.offsetLeft+D.offsetWidth-B)+"px"}$.top=(D.offsetTop+D.offsetHeight)+"px"};Calendar.showYearsCombo=function(C){var D=Calendar._C;if(!D)return false;var D=D,H=D.activeDiv,_=D.yearsCombo;if(D.hilitedYear)Calendar.removeClass(D.hilitedYear,"hilite");if(D.activeYear)Calendar.removeClass(D.activeYear,"active");D.activeYear=null;var E=D.date.getFullYear()+(C?1:-1),A=_.firstChild,B=false;for(var G=12;G>0;--G){if(E>=D.minYear&&E<=D.maxYear){A.innerHTML=E;A.year=E;A.style.display="block";B=true}else A.style.display="none";A=A.nextSibling;E+=C?D.yearStep:-D.yearStep}if(B){var $=_.style;$.display="block";if(H.navtype<0)$.left=H.offsetLeft+"px";else{var F=_.offsetWidth;if(typeof F=="undefined")F=50;$.left=(H.offsetLeft+H.offsetWidth-F)+"px"}$.top=(H.offsetTop+H.offsetHeight)+"px"}};Calendar.tableMouseUp=function(ev){var cal=Calendar._C;if(!cal)return false;if(cal.timeout)clearTimeout(cal.timeout);var $=cal.activeDiv;if(!$)return false;var _=Calendar.getTargetElement(ev);ev||(ev=window.event);Calendar.removeClass($,"active");if(_==$||_.parentNode==$)Calendar.cellClick($,ev);var A=Calendar.findMonth(_),C=null;if(A){C=new Date(cal.date);if(A.month!=C.getMonth()){C.setMonth(A.month);cal.setDate(C);cal.dateClicked=false;cal.callHandler()}}else{var B=Calendar.findYear(_);if(B){C=new Date(cal.date);if(B.year!=C.getFullYear()){C.setFullYear(B.year);cal.setDate(C);cal.dateClicked=false;cal.callHandler()}}}with(Calendar){removeEvent(document,"mouseup",tableMouseUp);removeEvent(document,"mouseover",tableMouseOver);removeEvent(document,"mousemove",tableMouseOver);cal._hideCombos();_C=null;return stopEvent(ev)}};Calendar.tableMouseOver=function($){var L=Calendar._C;if(!L)return;var H=L.activeDiv,I=Calendar.getTargetElement($);if(I==H||I.parentNode==H){Calendar.addClass(H,"hilite active");Calendar.addClass(H.parentNode,"rowhilite")}else{if(typeof H.navtype=="undefined"||(H.navtype!=50&&(H.navtype==0||Math.abs(H.navtype)>2)))Calendar.removeClass(H,"active");Calendar.removeClass(H,"hilite");Calendar.removeClass(H.parentNode,"rowhilite")}$||($=window.event);if(H.navtype==50&&I!=H){var E=Calendar.getAbsolutePos(H),F=H.offsetWidth,N=$.clientX,_,M=true;if(N>E.x+F){_=N-E.x-F;M=false}else _=E.x-N;if(_<0)_=0;var A=H._range,J=H._current,B=Math.floor(_/10)%A.length;for(var D=A.length;--D>=0;)if(A[D]==J)break;while(B-->0)if(M){if(--D<0)D=A.length-1}else if(++D>=A.length)D=0;var G=A[D];H.innerHTML=G;L.onUpdateTime()}var C=Calendar.findMonth(I);if(C){if(C.month!=L.date.getMonth()){if(L.hilitedMonth)Calendar.removeClass(L.hilitedMonth,"hilite");Calendar.addClass(C,"hilite");L.hilitedMonth=C}else if(L.hilitedMonth)Calendar.removeClass(L.hilitedMonth,"hilite")}else{if(L.hilitedMonth)Calendar.removeClass(L.hilitedMonth,"hilite");var K=Calendar.findYear(I);if(K){if(K.year!=L.date.getFullYear()){if(L.hilitedYear)Calendar.removeClass(L.hilitedYear,"hilite");Calendar.addClass(K,"hilite");L.hilitedYear=K}else if(L.hilitedYear)Calendar.removeClass(L.hilitedYear,"hilite")}else if(L.hilitedYear)Calendar.removeClass(L.hilitedYear,"hilite")}return Calendar.stopEvent($)};Calendar.tableMouseDown=function($){if(Calendar.getTargetElement($)==Calendar.getElement($))return Calendar.stopEvent($)};Calendar.calDragIt=function($){var C=Calendar._C;if(!(C&&C.dragging))return false;var A,_;if(Calendar.is_ie){_=window.event.clientY+document.body.scrollTop;A=window.event.clientX+document.body.scrollLeft}else{A=$.pageX;_=$.pageY}C.hideShowCovered();var B=C.element.style;B.left=(A-C.xOffs)+"px";B.top=(_-C.yOffs)+"px";return Calendar.stopEvent($)};Calendar.calDragEnd=function(ev){var $=Calendar._C;if(!$)return false;$.dragging=false;with(Calendar){removeEvent(document,"mousemove",calDragIt);removeEvent(document,"mouseup",calDragEnd);tableMouseUp(ev)}$.hideShowCovered()};Calendar.dayMouseDown=function($){var el=Calendar.getElement($);if(el.disabled)return false;var _=el.calendar;_.activeDiv=el;Calendar._C=_;if(el.navtype!=300)with(Calendar){if(el.navtype==50){el._current=el.innerHTML;addEvent(document,"mousemove",tableMouseOver)}else addEvent(document,Calendar.is_ie5?"mousemove":"mouseover",tableMouseOver);addClass(el,"hilite active");addEvent(document,"mouseup",tableMouseUp)}else if(_.isPopup)_._dragStart($);if(el.navtype==-1||el.navtype==1){if(_.timeout)clearTimeout(_.timeout);_.timeout=setTimeout("Calendar.showMonthsCombo()",250)}else if(el.navtype==-2||el.navtype==2){if(_.timeout)clearTimeout(_.timeout);_.timeout=setTimeout((el.navtype>0)?"Calendar.showYearsCombo(true)":"Calendar.showYearsCombo(false)",250)}else _.timeout=null;return Calendar.stopEvent($)};Calendar.dayMouseDblClick=function($){Calendar.cellClick(Calendar.getElement($),$||window.event);if(Calendar.is_ie)document.selection.empty()};Calendar.dayMouseOver=function($){var _=Calendar.getElement($);if(Calendar.isRelated(_,$)||Calendar._C||_.disabled)return false;if(_.ttip){if(_.ttip.substr(0,1)=="_")_.ttip=_.caldate.print(_.calendar.ttDateFormat)+_.ttip.substr(1);_.calendar.tooltips.innerHTML=_.ttip}if(_.navtype!=300){Calendar.addClass(_,"hilite");if(_.caldate)Calendar.addClass(_.parentNode,"rowhilite")}return Calendar.stopEvent($)};Calendar.dayMouseOut=function(ev){with(Calendar){var el=getElement(ev);if(isRelated(el,ev)||_C||el.disabled)return false;removeClass(el,"hilite");if(el.caldate)removeClass(el.parentNode,"rowhilite");if(el.calendar)el.calendar.tooltips.innerHTML=_TT["SEL_DATE"];return stopEvent(ev)}};Calendar.cellClick=function(H,_){var K=H.calendar,M=false,B=false,D=null;if(typeof H.navtype=="undefined"){if(K.currentDateEl){Calendar.removeClass(K.currentDateEl,"selected");Calendar.addClass(H,"selected");M=(K.currentDateEl==H);if(!M)K.currentDateEl=H}K.date.setDateOnly(H.caldate);D=K.date;var L=!(K.dateClicked=!H.otherMonth);if(!L&&!K.currentDateEl)K._toggleMultipleDate(new Date(D));else B=!H.disabled;if(L)K._init(K.firstDayOfWeek,D)}else{if(H.navtype==200){Calendar.removeClass(H,"hilite");K.callCloseHandler();return}D=new Date(K.date);if(H.navtype==0)D.setDateOnly(new Date());K.dateClicked=false;var J=D.getFullYear(),C=D.getMonth();function E(A){var _=D.getDate(),$=D.getMonthDays(A);if(_>$)D.setDate($);D.setMonth(A)}switch(H.navtype){case 400:Calendar.removeClass(H,"hilite");var $=Calendar._TT["ABOUT"];if(typeof $!="undefined")$+=K.showsTime?Calendar._TT["ABOUT_TIME"]:"";else $="Help and about box text is not translated into this language.\n"+"If you know this language and you feel generous please update\n"+"the corresponding file in \"lang\" subdir to match calendar-en.js\n"+"and send it back to <mihai_bazon@yahoo.com> to get it into the distribution  ;-)\n\n"+"Thank you!\n"+"http://dynarch.com/mishoo/calendar.epl\n";alert($);return;case-2:if(J>K.minYear)D.setFullYear(J-1);break;case-1:if(C>0)E(C-1);else if(J-->K.minYear){D.setFullYear(J);E(11)}break;case 1:if(C<11)E(C+1);else if(J<K.maxYear){D.setFullYear(J+1);E(0)}break;case 2:if(J<K.maxYear)D.setFullYear(J+1);break;case 100:K.setFirstDayOfWeek(H.fdow);return;case 50:var A=H._range,I=H.innerHTML;for(var F=A.length;--F>=0;)if(A[F]==I)break;if(_&&_.shiftKey){if(--F<0)F=A.length-1}else if(++F>=A.length)F=0;var G=A[F];H.innerHTML=G;K.onUpdateTime();return;case 0:if((typeof K.getDateStatus=="function")&&K.getDateStatus(D,D.getFullYear(),D.getMonth(),D.getDate()))return false;break}if(!D.equalsTo(K.date)){K.setDate(D);B=true}else if(H.navtype==0)B=M=true}if(B)_&&K.callHandler();if(M){Calendar.removeClass(H,"hilite");_&&K.callCloseHandler()}};Calendar.prototype.create=function(A){var D=null;if(!A){D=document.getElementsByTagName("body")[0];this.isPopup=true}else{D=A;this.isPopup=false}this.date=this.dateStr?new Date(this.dateStr):new Date();var F=Calendar.createElement("table");this.table=F;F.cellSpacing=0;F.cellPadding=0;F.calendar=this;Calendar.addEvent(F,"mousedown",Calendar.tableMouseDown);var C=Calendar.createElement("div");this.element=C;C.className="calendar";if(this.isPopup){C.style.position="absolute";C.style.display="none"}C.appendChild(F);var _=Calendar.createElement("thead",F),B=null,I=null,N=this,E=function($,A,_){B=Calendar.createElement("td",I);B.colSpan=A;B.className="button";if(_!=0&&Math.abs(_)<=2)B.className+=" nav";Calendar._add_evs(B);B.calendar=N;B.navtype=_;B.innerHTML="<div unselectable='on'>"+$+"</div>";return B};I=Calendar.createElement("tr",_);var M=6;(this.isPopup)&&--M;(this.weekNumbers)&&++M;E("?",1,400).ttip=Calendar._TT["INFO"];this.title=E("",M,300);this.title.className="title";if(this.isPopup){this.title.ttip=Calendar._TT["DRAG_TO_MOVE"];this.title.style.cursor="move";E("&#x00d7;",1,200).ttip=Calendar._TT["CLOSE"]}I=Calendar.createElement("tr",_);I.className="headrow";this._nav_py=E("&#x00ab;",1,-2);this._nav_py.ttip=Calendar._TT["PREV_YEAR"];this._nav_pm=E("&#x2039;",1,-1);this._nav_pm.ttip=Calendar._TT["PREV_MONTH"];this._nav_now=E(Calendar._TT["TODAY"],this.weekNumbers?4:3,0);this._nav_now.ttip=Calendar._TT["GO_TODAY"];this._nav_nm=E("&#x203a;",1,1);this._nav_nm.ttip=Calendar._TT["NEXT_MONTH"];this._nav_ny=E("&#x00bb;",1,2);this._nav_ny.ttip=Calendar._TT["NEXT_YEAR"];I=Calendar.createElement("tr",_);I.className="daynames";if(this.weekNumbers){B=Calendar.createElement("td",I);B.className="name wn";B.innerHTML=Calendar._TT["WK"]}for(var J=7;J>0;--J){B=Calendar.createElement("td",I);if(!J){B.navtype=100;B.calendar=this;Calendar._add_evs(B)}}this.firstdayname=(this.weekNumbers)?I.firstChild.nextSibling:I.firstChild;this._displayWeekdays();var K=Calendar.createElement("tbody",F);this.tbody=K;for(J=6;J>0;--J){I=Calendar.createElement("tr",K);if(this.weekNumbers)B=Calendar.createElement("td",I);for(var G=7;G>0;--G){B=Calendar.createElement("td",I);B.calendar=this;Calendar._add_evs(B)}}if(this.showsTime){I=Calendar.createElement("tr",K);I.className="time";B=Calendar.createElement("td",I);B.className="time";B.colSpan=2;B.innerHTML=Calendar._TT["TIME"]||"&nbsp;";B=Calendar.createElement("td",I);B.className="time";B.colSpan=this.weekNumbers?4:3;(function(){function D(A,_,D,$){var C=Calendar.createElement("span",B);C.className=A;C.innerHTML=_;C.calendar=N;C.ttip=Calendar._TT["TIME_PART"];C.navtype=50;C._range=[];if(typeof D!="number")C._range=D;else for(var F=D;F<=$;++F){var E;if(F<10&&$>=10)E="0"+F;else E=""+F;C._range[C._range.length]=E}Calendar._add_evs(C);return C}var $=N.date.getHours(),E=N.date.getMinutes(),_=!N.time24,C=($>12);if(_&&C)$-=12;var F=D("hour",$,_?1:0,_?12:23),H=Calendar.createElement("span",B);H.innerHTML=":";H.className="colon";var A=D("minute",E,0,59),G=null;B=Calendar.createElement("td",I);B.className="time";B.colSpan=2;if(_)G=D("ampm",C?"pm":"am",["am","pm"]);else B.innerHTML="&nbsp;";N.onSetTime=function(){var B,$=this.date.getHours(),C=this.date.getMinutes();if(_){B=($>=12);if(B)$-=12;if($==0)$=12;G.innerHTML=B?"pm":"am"}F.innerHTML=($<10)?("0"+$):$;A.innerHTML=(C<10)?("0"+C):C};N.onUpdateTime=function(){var C=this.date,E=parseInt(F.innerHTML,10);if(_)if(/pm/i.test(G.innerHTML)&&E<12)E+=12;else if(/am/i.test(G.innerHTML)&&E==12)E=0;var $=C.getDate(),B=C.getMonth(),D=C.getFullYear();C.setHours(E);C.setMinutes(parseInt(A.innerHTML,10));C.setFullYear(D);C.setMonth(B);C.setDate($);this.dateClicked=false;this.callHandler()}})()}else this.onSetTime=this.onUpdateTime=function(){};var H=Calendar.createElement("tfoot",F);I=Calendar.createElement("tr",H);I.className="footrow";B=E(Calendar._TT["SEL_DATE"],this.weekNumbers?8:7,300);B.className="ttip";if(this.isPopup){B.ttip=Calendar._TT["DRAG_TO_MOVE"];B.style.cursor="move"}this.tooltips=B;C=Calendar.createElement("div",this.element);this.monthsCombo=C;C.className="combo";for(J=0;J<Calendar._MN.length;++J){var $=Calendar.createElement("div");$.className=Calendar.is_ie?"label-IEfix":"label";$.month=J;$.innerHTML=Calendar._SMN[J];C.appendChild($)}C=Calendar.createElement("div",this.element);this.yearsCombo=C;C.className="combo";for(J=12;J>0;--J){var L=Calendar.createElement("div");L.className=Calendar.is_ie?"label-IEfix":"label";C.appendChild(L)}this._init(this.firstDayOfWeek,this.date);D.appendChild(this.element)};Calendar._keyEvent=function($){var F=window._dynarch_popupCalendar;if(!F||F.multiple)return false;(Calendar.is_ie)&&($=window.event);var G=(Calendar.is_ie||$.type=="keypress"),B=$.keyCode;if($.ctrlKey)switch(B){case 37:G&&Calendar.cellClick(F._nav_pm);break;case 38:G&&Calendar.cellClick(F._nav_py);break;case 39:G&&Calendar.cellClick(F._nav_nm);break;case 40:G&&Calendar.cellClick(F._nav_ny);break;default:return false}else switch(B){case 32:Calendar.cellClick(F._nav_now);break;case 27:G&&F.callCloseHandler();break;case 37:case 38:case 39:case 40:if(G){var C,K,I,E,D,J;C=B==37||B==38;J=(B==37||B==39)?1:7;function H(){D=F.currentDateEl;var $=D.pos;K=$&15;I=$>>4;E=F.ar_days[I][K]}H();function A(){var $=new Date(F.date);$.setDate($.getDate()-J);F.setDate($)}function _(){var $=new Date(F.date);$.setDate($.getDate()+J);F.setDate($)}while(1){switch(B){case 37:if(--K>=0)E=F.ar_days[I][K];else{K=6;B=38;continue}break;case 38:if(--I>=0)E=F.ar_days[I][K];else{A();H()}break;case 39:if(++K<7)E=F.ar_days[I][K];else{K=0;B=40;continue}break;case 40:if(++I<F.ar_days.length)E=F.ar_days[I][K];else{_();H()}break}break}if(E)if(!E.disabled)Calendar.cellClick(E);else if(C)A();else _()}break;case 13:if(G)Calendar.cellClick(F.currentDateEl,$);break;default:return false}return Calendar.stopEvent($)};Calendar.prototype._init=function(J,D){var A=new Date(),X=A.getFullYear(),B=A.getMonth(),$=A.getDate();this.table.style.visibility="hidden";var H=D.getFullYear();if(H<this.minYear){H=this.minYear;D.setFullYear(H)}else if(H>this.maxYear){H=this.maxYear;D.setFullYear(H)}this.firstDayOfWeek=J;this.date=new Date(D);var W=D.getMonth(),P=D.getDate(),C=D.getMonthDays();D.setDate(1);var V=(D.getDay()-this.firstDayOfWeek)%7;if(V<0)V+=7;D.setDate(-V);D.setDate(D.getDate()+1);var T=this.tbody.firstChild,Q=Calendar._SMN[W],L=this.ar_days=new Array(),G=Calendar._TT["WEEKEND"],F=this.multiple?(this.datesCells={}):null;for(var U=0;U<6;++U,T=T.nextSibling){var O=T.firstChild;if(this.weekNumbers){O.className="day wn";O.innerHTML=D.getWeekNumber();O=O.nextSibling}T.className="daysrow";var R=false,K,E=L[U]=[];for(var S=0;S<7;++S,O=O.nextSibling,D.setDate(K+1)){K=D.getDate();var _=D.getDay();O.className="day";O.pos=U<<4|S;E[S]=O;var I=(D.getMonth()==W);if(!I){if(this.showsOtherMonths){O.className+=" othermonth";O.otherMonth=true}else{O.className="emptycell";O.innerHTML="&nbsp;";O.disabled=true;continue}}else{O.otherMonth=false;R=true}O.disabled=false;O.innerHTML=this.getDateText?this.getDateText(D,K):K;if(F)F[D.print("%Y%m%d")]=O;if(this.getDateStatus){var M=this.getDateStatus(D,H,W,K);if(this.getDateToolTip){var N=this.getDateToolTip(D,H,W,K);if(N)O.title=N}if(M===true){O.className+=" disabled";O.disabled=true}else{if(/disabled/i.test(M))O.disabled=true;O.className+=" "+M}}if(!O.disabled){O.caldate=new Date(D);O.ttip="_";if(!this.multiple&&I&&K==P&&this.hiliteToday){O.className+=" selected";this.currentDateEl=O}if(D.getFullYear()==X&&D.getMonth()==B&&K==$){O.className+=" today";O.ttip+=Calendar._TT["PART_TODAY"]}if(G.indexOf(_.toString())!=-1)O.className+=O.otherMonth?" oweekend":" weekend"}}if(!(R||this.showsOtherMonths))T.className="emptyrow"}this.title.innerHTML=Calendar._MN[W]+", "+H;this.onSetTime();this.table.style.visibility="visible";this._initMultipleDates()};Calendar.prototype._initMultipleDates=function(){if(this.multiple)for(var A in this.multiple){var _=this.datesCells[A],$=this.multiple[A];if(!$)continue;if(_)_.className+=" selected"}};Calendar.prototype._toggleMultipleDate=function(A){if(this.multiple){var B=A.print("%Y%m%d"),_=this.datesCells[B];if(_){var $=this.multiple[B];if(!$){Calendar.addClass(_,"selected");this.multiple[B]=A}else{Calendar.removeClass(_,"selected");delete this.multiple[B]}}}};Calendar.prototype.setDateToolTipHandler=function($){this.getDateToolTip=$};Calendar.prototype.setDate=function($){if(!$.equalsTo(this.date))this._init(this.firstDayOfWeek,$)};Calendar.prototype.refresh=function(){this._init(this.firstDayOfWeek,this.date)};Calendar.prototype.setFirstDayOfWeek=function($){this._init($,this.date);this._displayWeekdays()};Calendar.prototype.setDateStatusHandler=Calendar.prototype.setDisabledHandler=function($){this.getDateStatus=$};Calendar.prototype.setRange=function($,_){this.minYear=$;this.maxYear=_};Calendar.prototype.callHandler=function(){if(this.onSelected)this.onSelected(this,this.date.print(this.dateFormat))};Calendar.prototype.callCloseHandler=function(){if(this.onClose)this.onClose(this);this.hideShowCovered()};Calendar.prototype.destroy=function(){var $=this.element.parentNode;$.removeChild(this.element);Calendar._C=null;window._dynarch_popupCalendar=null};Calendar.prototype.reparent=function(_){var $=this.element;$.parentNode.removeChild($);_.appendChild($)};Calendar._checkCalendar=function($){var A=window._dynarch_popupCalendar;if(!A)return false;var _=Calendar.is_ie?Calendar.getElement($):Calendar.getTargetElement($);for(;_!=null&&_!=A.element;_=_.parentNode);if(_==null){window._dynarch_popupCalendar.callCloseHandler();return Calendar.stopEvent($)}};Calendar.prototype.show=function(){var D=this.table.getElementsByTagName("tr");for(var C=D.length;C>0;){var B=D[--C];Calendar.removeClass(B,"rowhilite");var $=B.getElementsByTagName("td");for(var A=$.length;A>0;){var _=$[--A];Calendar.removeClass(_,"hilite");Calendar.removeClass(_,"active")}}this.element.style.display="block";this.hidden=false;if(this.isPopup){window._dynarch_popupCalendar=this;Calendar.addEvent(document,"keydown",Calendar._keyEvent);Calendar.addEvent(document,"keypress",Calendar._keyEvent);Calendar.addEvent(document,"mousedown",Calendar._checkCalendar)}this.hideShowCovered()};Calendar.prototype.hide=function(){if(this.isPopup){Calendar.removeEvent(document,"keydown",Calendar._keyEvent);Calendar.removeEvent(document,"keypress",Calendar._keyEvent);Calendar.removeEvent(document,"mousedown",Calendar._checkCalendar)}this.element.style.display="none";this.hidden=true;this.hideShowCovered()};Calendar.prototype.showAt=function(A,_){var $=this.element.style;$.left=A+"px";$.top=_+"px";this.show()};Calendar.prototype.showAtElement=function(_,$){var C=this,A=Calendar.getAbsolutePos(_);if(!$||typeof $!="string"){this.showAt(A.x,A.y+_.offsetHeight);return true}function B(B){if(B.x<0)B.x=0;if(B.y<0)B.y=0;var $=document.createElement("div"),_=$.style;_.position="absolute";_.right=_.bottom=_.width=_.height="0px";document.body.appendChild($);var C=Calendar.getAbsolutePos($);document.body.removeChild($);if(Calendar.is_ie){C.y+=document.body.scrollTop;C.x+=document.body.scrollLeft}else{C.y+=window.scrollY;C.x+=window.scrollX}var A=B.x+B.width-C.x;if(A>0)B.x-=A;A=B.y+B.height-C.y;if(A>0)B.y-=A}this.element.style.display="block";Calendar.continuation_for_the_fucking_khtml_browser=function(){var D=C.element.offsetWidth,G=C.element.offsetHeight;C.element.style.display="none";var F=$.substr(0,1),E="l";if($.length>1)E=$.substr(1,1);switch(F){case"T":A.y-=G;break;case"B":A.y+=_.offsetHeight;break;case"C":A.y+=(_.offsetHeight-G)/2;break;case"t":A.y+=_.offsetHeight-G;break;case"b":break}switch(E){case"L":A.x-=D;break;case"R":A.x+=_.offsetWidth;break;case"C":A.x+=(_.offsetWidth-D)/2;break;case"l":A.x+=_.offsetWidth-D;break;case"r":break}A.width=D;A.height=G+40;C.monthsCombo.style.display="none";B(A);C.showAt(A.x,A.y)};if(Calendar.is_khtml)setTimeout("Calendar.continuation_for_the_fucking_khtml_browser()",10);else Calendar.continuation_for_the_fucking_khtml_browser()};Calendar.prototype.setDateFormat=function($){this.dateFormat=$};Calendar.prototype.setTtDateFormat=function($){this.ttDateFormat=$};Calendar.prototype.parseDate=function($,_){if(!_)_=this.dateFormat;this.setDate(Date.parseDate($,_))};Calendar.prototype.hideShowCovered=function(){if(!Calendar.is_ie&&!Calendar.is_opera)return;function D(_){var $=_.style.visibility;if(!$)if(document.defaultView&&typeof(document.defaultView.getComputedStyle)=="function"){if(!Calendar.is_khtml)$=document.defaultView.getComputedStyle(_,"").getPropertyValue("visibility");else $=""}else if(_.currentStyle)$=_.currentStyle.visibility;else $="";return $}var $=new Array("applet","iframe","select"),L=this.element,M=Calendar.getAbsolutePos(L),G=M.x,E=L.offsetWidth+G,F=M.y,I=L.offsetHeight+F;for(var J=$.length;J>0;){var H=document.getElementsByTagName($[--J]),N=null;for(var K=H.length;K>0;){N=H[--K];M=Calendar.getAbsolutePos(N);var A=M.x,B=N.offsetWidth+A,_=M.y,C=N.offsetHeight+_;if(this.hidden||(A>E)||(B<G)||(_>I)||(C<F)){if(!N.__msh_save_visibility)N.__msh_save_visibility=D(N);N.style.visibility=N.__msh_save_visibility}else{if(!N.__msh_save_visibility)N.__msh_save_visibility=D(N);N.style.visibility="hidden"}}}};Calendar.prototype._displayWeekdays=function(){var $=this.firstDayOfWeek,_=this.firstdayname,B=Calendar._TT["WEEKEND"];for(var C=0;C<7;++C){_.className="day name";var A=(C+$)%7;if(C){_.ttip=Calendar._TT["DAY_FIRST"].replace("%s",Calendar._DN[A]);_.navtype=100;_.calendar=this;_.fdow=A;Calendar._add_evs(_)}if(B.indexOf(A.toString())!=-1)Calendar.addClass(_,"weekend");_.innerHTML=Calendar._SDN[(C+$)%7];_=_.nextSibling}};Calendar.prototype._hideCombos=function(){this.monthsCombo.style.display="none";this.yearsCombo.style.display="none"};Calendar.prototype._dragStart=function($){if(this.dragging)return;this.dragging=true;var A,_;if(Calendar.is_ie){_=window.event.clientY+document.body.scrollTop;A=window.event.clientX+document.body.scrollLeft}else{_=$.clientY+window.scrollY;A=$.clientX+window.scrollX}var B=this.element.style;this.xOffs=A-parseInt(B.left);this.yOffs=_-parseInt(B.top);with(Calendar){addEvent(document,"mousemove",calDragIt);addEvent(document,"mouseup",calDragEnd)}};Date._MD=new Array(31,28,31,30,31,30,31,31,30,31,30,31);Date.SECOND=1000;Date.MINUTE=60*Date.SECOND;Date.HOUR=60*Date.MINUTE;Date.DAY=24*Date.HOUR;Date.WEEK=7*Date.DAY;Date.parseDate=function(J,C){var E=new Date(),K=0,F=-1,A=0,D=J.split(/\W+/),B=C.match(/%./g),H=0,G=0,$=0,_=0;for(H=0;H<D.length;++H){if(!D[H])continue;switch(B[H]){case"%d":case"%e":A=parseInt(D[H],10);break;case"%m":F=parseInt(D[H],10)-1;break;case"%Y":case"%y":K=parseInt(D[H],10);(K<100)&&(K+=(K>29)?1900:2000);break;case"%b":case"%B":for(G=0;G<12;++G)if(Calendar._MN[G].substr(0,D[H].length).toLowerCase()==D[H].toLowerCase()){F=G;break}break;case"%H":case"%I":case"%k":case"%l":$=parseInt(D[H],10);break;case"%P":case"%p":if(/pm/i.test(D[H])&&$<12)$+=12;else if(/am/i.test(D[H])&&$>=12)$-=12;break;case"%M":_=parseInt(D[H],10);break}}if(isNaN(K))K=E.getFullYear();if(isNaN(F))F=E.getMonth();if(isNaN(A))A=E.getDate();if(isNaN($))$=E.getHours();if(isNaN(_))_=E.getMinutes();if(K!=0&&F!=-1&&A!=0)return new Date(K,F,A,$,_,0);K=0;F=-1;A=0;for(H=0;H<D.length;++H)if(D[H].search(/[a-zA-Z]+/)!=-1){var I=-1;for(G=0;G<12;++G)if(Calendar._MN[G].substr(0,D[H].length).toLowerCase()==D[H].toLowerCase()){I=G;break}if(I!=-1){if(F!=-1)A=F+1;F=I}}else if(parseInt(D[H],10)<=12&&F==-1)F=D[H]-1;else if(parseInt(D[H],10)>31&&K==0){K=parseInt(D[H],10);(K<100)&&(K+=(K>29)?1900:2000)}else if(A==0)A=D[H];if(K==0)K=E.getFullYear();if(F!=-1&&A!=0)return new Date(K,F,A,$,_,0);return E};Date.prototype.getMonthDays=function($){var _=this.getFullYear();if(typeof $=="undefined")$=this.getMonth();if(((0==(_%4))&&((0!=(_%100))||(0==(_%400))))&&$==1)return 29;else return Date._MD[$]};Date.prototype.getDayOfYear=function(){var _=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0),A=new Date(this.getFullYear(),0,0,0,0,0),$=_-A;return Math.floor($/Date.DAY)};Date.prototype.getWeekNumber=function(){var $=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0),A=$.getDay();$.setDate($.getDate()-(A+6)%7+3);var _=$.valueOf();$.setMonth(0);$.setDate(4);return Math.round((_-$.valueOf())/(7*86400000))+1};Date.prototype.equalsTo=function($){return((this.getFullYear()==$.getFullYear())&&(this.getMonth()==$.getMonth())&&(this.getDate()==$.getDate())&&(this.getHours()==$.getHours())&&(this.getMinutes()==$.getMinutes()))};Date.prototype.setDateOnly=function(_){var $=new Date(_);this.setDate(1);this.setFullYear($.getFullYear());this.setMonth($.getMonth());this.setDate($.getDate())};Date.prototype.print=function(J){var F=this.getMonth(),B=this.getDate(),O=this.getFullYear(),E=this.getWeekNumber(),I=this.getDay(),K={},$=this.getHours(),N=($>=12),A=(N)?($-12):$,C=this.getDayOfYear();if(A==0)A=12;var _=this.getMinutes(),L=this.getSeconds();K["%a"]=Calendar._SDN[I];K["%A"]=Calendar._DN[I];K["%b"]=Calendar._SMN[F];K["%B"]=Calendar._MN[F];K["%C"]=1+Math.floor(O/100);K["%d"]=(B<10)?("0"+B):B;K["%e"]=B;K["%H"]=($<10)?("0"+$):$;K["%I"]=(A<10)?("0"+A):A;K["%j"]=(C<100)?((C<10)?("00"+C):("0"+C)):C;K["%k"]=$;K["%l"]=A;K["%m"]=(F<9)?("0"+(1+F)):(1+F);K["%M"]=(_<10)?("0"+_):_;K["%n"]="\n";K["%p"]=N?"PM":"AM";K["%P"]=N?"pm":"am";K["%s"]=Math.floor(this.getTime()/1000);K["%S"]=(L<10)?("0"+L):L;K["%t"]="\t";K["%U"]=K["%W"]=K["%V"]=(E<10)?("0"+E):E;K["%u"]=I+1;K["%w"]=I;K["%y"]=(""+O).substr(2,2);K["%Y"]=O;K["%%"]="%";var G=/%./g;if(!Calendar.is_ie5&&!Calendar.is_khtml)return J.replace(G,function($){return K[$]||$});var D=J.match(G);for(var H=0;H<D.length;H++){var M=K[D[H]];if(M){G=new RegExp(D[H],"g");J=J.replace(G,M)}}return J};Date.prototype.__msh_oldSetFullYear=Date.prototype.setFullYear;Date.prototype.setFullYear=function(_){var $=new Date(this);$.__msh_oldSetFullYear(_);if($.getMonth()!=this.getMonth())this.setDate(28);this.__msh_oldSetFullYear(_)};window._dynarch_popupCalendar=null